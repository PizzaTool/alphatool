import{r as t}from"./index39.js";import{cK as e,cL as n,cM as s,cN as i,cO as r,cP as a,cQ as o,cR as c,cS as u,cT as l,cU as d,cV as h,cW as p,cX as y,cY as m}from"./index.js";import{c as f,H as g,a as b,u as w,s as v,b as x,t as I,d as $,e as B,f as T}from"./utils.js";const k=/^tuple(?<array>(\[(\d*)\])*)$/;function A(t){let e=t.type;if(k.test(t.type)&&"components"in t){e="(";const n=t.components.length;for(let i=0;i<n;i++){e+=A(t.components[i]),i<n-1&&(e+=", ")}const s=function(t,e){const n=t.exec(e);return null==n?void 0:n.groups}(k,t.type);return e+=`)${(null==s?void 0:s.array)??""}`,A({...t,type:e})}return"indexed"in t&&t.indexed&&(e=`${e} indexed`),t.name?`${e} ${t.name}`:e}function S(t){let e="";const n=t.length;for(let s=0;s<n;s++){e+=A(t[s]),s!==n-1&&(e+=", ")}return e}function P(t,{includeName:e=!1}={}){if("function"!==t.type&&"event"!==t.type&&"error"!==t.type)throw new L(t.type);return`${t.name}(${_(t.inputs,{includeName:e})})`}function _(t,{includeName:e=!1}={}){return t?t.map((t=>function(t,{includeName:e}){if(t.type.startsWith("tuple"))return`(${_(t.components,{includeName:e})})${t.type.slice(5)}`;return t.type+(e&&t.name?` ${t.name}`:"")}(t,{includeName:e}))).join(e?", ":","):""}class M extends e{constructor({expectedLength:t,givenLength:e,type:n}){super([`ABI encoding array length mismatch for type ${n}.`,`Expected length: ${t}`,`Given length: ${e}`].join("\n"),{name:"AbiEncodingArrayLengthMismatchError"})}}class E extends e{constructor({expectedSize:t,value:e}){super(`Size of bytes "${e}" (bytes${n(e)}) does not match expected size (bytes${t}).`,{name:"AbiEncodingBytesSizeMismatchError"})}}class z extends e{constructor({expectedLength:t,givenLength:e}){super(["ABI encoding params/values length mismatch.",`Expected length (params): ${t}`,`Given length (values): ${e}`].join("\n"),{name:"AbiEncodingLengthMismatchError"})}}class O extends e{constructor(t,{docsPath:e}={}){super([`Function ${t?`"${t}" `:""}not found on ABI.`,"Make sure you are using the correct ABI and that the function exists on it."].join("\n"),{docsPath:e,name:"AbiFunctionNotFoundError"})}}class N extends e{constructor(t,e){super("Found ambiguous types in overloaded ABI items.",{metaMessages:[`\`${t.type}\` in \`${P(t.abiItem)}\`, and`,`\`${e.type}\` in \`${P(e.abiItem)}\``,"","These types encode differently and cannot be distinguished at runtime.","Remove one of the ambiguous items in the ABI."],name:"AbiItemAmbiguityError"})}}class C extends e{constructor({expectedSize:t,givenSize:e}){super(`Expected bytes${t}, got bytes${e}.`,{name:"BytesSizeMismatchError"})}}class j extends e{constructor(t,{docsPath:e}){super([`Type "${t}" is not a valid encoding type.`,"Please provide a valid ABI type."].join("\n"),{docsPath:e,name:"InvalidAbiEncodingType"})}}class q extends e{constructor(t){super([`Value "${t}" is not a valid array.`].join("\n"),{name:"InvalidArrayError"})}}class L extends e{constructor(t){super([`"${t}" is not a valid definition type.`,'Valid types: "function", "event", "error"'].join("\n"),{name:"InvalidDefinitionTypeError"})}}const R=new TextEncoder;function H(t,e={}){return"number"==typeof t||"bigint"==typeof t?function(t,e){const n=i(t,e);return V(n)}(t,e):"boolean"==typeof t?function(t,e={}){const n=new Uint8Array(1);if(n[0]=Number(t),"number"==typeof e.size)return r(n,{size:e.size}),a(n,{size:e.size});return n}(t,e):s(t)?V(t,e):D(t,e)}const F={zero:48,nine:57,A:65,F:70,a:97,f:102};function U(t){return t>=F.zero&&t<=F.nine?t-F.zero:t>=F.A&&t<=F.F?t-(F.A-10):t>=F.a&&t<=F.f?t-(F.a-10):void 0}function V(t,n={}){let s=t;n.size&&(r(s,{size:n.size}),s=a(s,{dir:"right",size:n.size}));let i=s.slice(2);i.length%2&&(i=`0${i}`);const o=i.length/2,c=new Uint8Array(o);for(let r=0,a=0;r<o;r++){const t=U(i.charCodeAt(a++)),n=U(i.charCodeAt(a++));if(void 0===t||void 0===n)throw new e(`Invalid byte sequence ("${i[a-2]}${i[a-1]}" in "${i}").`);c[r]=16*t+n}return c}function D(t,e={}){const n=R.encode(t);return"number"==typeof e.size?(r(n,{size:e.size}),a(n,{dir:"right",size:e.size})):n}const W=BigInt(2**32-1),G=BigInt(32);function X(t,e=!1){return e?{h:Number(t&W),l:Number(t>>G&W)}:{h:0|Number(t>>G&W),l:0|Number(t&W)}}const J=BigInt(0),K=BigInt(1),Q=BigInt(2),Y=BigInt(7),Z=BigInt(256),tt=BigInt(113),et=[],nt=[],st=[];for(let ye=0,me=K,fe=1,ge=0;ye<24;ye++){[fe,ge]=[ge,(2*fe+3*ge)%5],et.push(2*(5*ge+fe)),nt.push((ye+1)*(ye+2)/2%64);let t=J;for(let e=0;e<7;e++)me=(me<<K^(me>>Y)*tt)%Z,me&Q&&(t^=K<<(K<<BigInt(e))-K);st.push(t)}const it=function(t,e=!1){const n=t.length;let s=new Uint32Array(n),i=new Uint32Array(n);for(let r=0;r<n;r++){const{h:n,l:a}=X(t[r],e);[s[r],i[r]]=[n,a]}return[s,i]}(st,!0),rt=it[0],at=it[1],ot=(t,e,n)=>n>32?((t,e,n)=>e<<n-32|t>>>64-n)(t,e,n):((t,e,n)=>t<<n|e>>>32-n)(t,e,n),ct=(t,e,n)=>n>32?((t,e,n)=>t<<n-32|e>>>64-n)(t,e,n):((t,e,n)=>e<<n|t>>>32-n)(t,e,n);class ut extends g{constructor(t,e,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=t,this.suffix=e,this.outputLen=n,this.enableXOF=s,this.rounds=i,b(n),!(0<t&&t<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=w(this.state)}clone(){return this._cloneInto()}keccak(){v(this.state32),function(t,e=24){const n=new Uint32Array(10);for(let s=24-e;s<24;s++){for(let s=0;s<10;s++)n[s]=t[s]^t[s+10]^t[s+20]^t[s+30]^t[s+40];for(let s=0;s<10;s+=2){const e=(s+8)%10,i=(s+2)%10,r=n[i],a=n[i+1],o=ot(r,a,1)^n[e],c=ct(r,a,1)^n[e+1];for(let n=0;n<50;n+=10)t[s+n]^=o,t[s+n+1]^=c}let e=t[2],i=t[3];for(let n=0;n<24;n++){const s=nt[n],r=ot(e,i,s),a=ct(e,i,s),o=et[n];e=t[o],i=t[o+1],t[o]=r,t[o+1]=a}for(let s=0;s<50;s+=10){for(let e=0;e<10;e++)n[e]=t[s+e];for(let e=0;e<10;e++)t[s+e]^=~n[(e+2)%10]&n[(e+4)%10]}t[0]^=rt[s],t[1]^=at[s]}T(n)}(this.state32,this.rounds),v(this.state32),this.posOut=0,this.pos=0}update(t){x(this),t=I(t),$(t);const{blockLen:e,state:n}=this,s=t.length;for(let i=0;i<s;){const r=Math.min(e-this.pos,s-i);for(let e=0;e<r;e++)n[this.pos++]^=t[i++];this.pos===e&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:t,suffix:e,pos:n,blockLen:s}=this;t[n]^=e,128&e&&n===s-1&&this.keccak(),t[s-1]^=128,this.keccak()}writeInto(t){x(this,!1),$(t),this.finish();const e=this.state,{blockLen:n}=this;for(let s=0,i=t.length;s<i;){this.posOut>=n&&this.keccak();const r=Math.min(n-this.posOut,i-s);t.set(e.subarray(this.posOut,this.posOut+r),s),this.posOut+=r,s+=r}return t}xofInto(t){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(t)}xof(t){return b(t),this.xofInto(new Uint8Array(t))}digestInto(t){if(B(t,this),this.finished)throw new Error("digest() was already called");return this.writeInto(t),this.destroy(),t}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,T(this.state)}_cloneInto(t){const{blockLen:e,suffix:n,outputLen:s,rounds:i,enableXOF:r}=this;return t||(t=new ut(e,n,s,r,i)),t.state32.set(this.state32),t.pos=this.pos,t.posOut=this.posOut,t.finished=this.finished,t.rounds=i,t.suffix=n,t.outputLen=s,t.enableXOF=r,t.destroyed=this.destroyed,t}}const lt=(()=>{return t=1,e=136,n=32,f((()=>new ut(e,t,n)));var t,e,n})();function dt(t,e){const n=e||"hex",i=lt(s(t,{strict:!1})?H(t):t);return"bytes"===n?i:o(i)}function ht(t){return dt(H(t))}const pt=t=>{var n,s;return function(t){let n=!0,s="",i=0,r="",a=!1;for(let e=0;e<t.length;e++){const o=t[e];if(["(",")",","].includes(o)&&(n=!0),"("===o&&i++,")"===o&&i--,n)if(0!==i)" "!==o?(r+=o,s+=o):","!==t[e-1]&&","!==s&&",("!==s&&(s="",n=!1);else if(" "===o&&["event","function",""].includes(r))r="";else if(r+=o,")"===o){a=!0;break}}if(!a)throw new e("Unable to normalize signature.");return r}("string"==typeof t?t:"function"===(n=t).type?`function ${n.name}(${S(n.inputs)})${n.stateMutability&&"nonpayable"!==n.stateMutability?` ${n.stateMutability}`:""}${(null==(s=n.outputs)?void 0:s.length)?` returns (${S(n.outputs)})`:""}`:"event"===n.type?`event ${n.name}(${S(n.inputs)})`:"error"===n.type?`error ${n.name}(${S(n.inputs)})`:"constructor"===n.type?`constructor(${S(n.inputs)})${"payable"===n.stateMutability?" payable":""}`:"fallback"===n.type?"fallback() external"+("payable"===n.stateMutability?" payable":""):"receive() external payable")};function yt(t){return ht(pt(t))}const mt=yt;class ft extends e{constructor({address:t}){super(`Address "${t}" is invalid.`,{metaMessages:["- Address must be a hex value of 20 bytes (40 hex characters).","- Address must match its checksum counterpart."],name:"InvalidAddressError"})}}const gt=new c(8192);const bt=/^0x[a-fA-F0-9]{40}$/,wt=new c(8192);function vt(t,e){const{strict:n=!0}=e??{},s=`${t}.${n}`;if(wt.has(s))return wt.get(s);const i=!(!bt.test(t)||t.toLowerCase()!==t&&n&&function(t,e){if(gt.has(`${t}.${e}`))return gt.get(`${t}.${e}`);const n=t.substring(2).toLowerCase(),s=dt(D(n),"bytes"),i=n.split("");for(let a=0;a<40;a+=2)s[a>>1]>>4>=8&&i[a]&&(i[a]=i[a].toUpperCase()),(15&s[a>>1])>=8&&i[a+1]&&(i[a+1]=i[a+1].toUpperCase());const r=`0x${i.join("")}`;return gt.set(`${t}.${e}`,r),r}(t)!==t);return wt.set(s,i),i}function xt(t){return"string"==typeof t[0]?It(t):function(t){let e=0;for(const i of t)e+=i.length;const n=new Uint8Array(e);let s=0;for(const i of t)n.set(i,s),s+=i.length;return n}(t)}function It(t){return`0x${t.reduce(((t,e)=>t+e.replace("0x","")),"")}`}function $t(t,e,n,{strict:i}={}){return s(t,{strict:!1})?function(t,e,n,{strict:s}={}){Bt(t,e);const i=`0x${t.replace("0x","").slice(2*(e??0),2*(n??t.length))}`;s&&Tt(i,e,n);return i}(t,e,n,{strict:i}):function(t,e,n,{strict:s}={}){Bt(t,e);const i=t.slice(e,n);s&&Tt(i,e,n);return i}(t,e,n,{strict:i})}function Bt(t,e){if("number"==typeof e&&e>0&&e>n(t)-1)throw new u({offset:e,position:"start",size:n(t)})}function Tt(t,e,s){if("number"==typeof e&&"number"==typeof s&&n(t)!==s-e)throw new u({offset:s,position:"end",size:n(t)})}const kt=/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/,At=/^(u?int)(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/;function St(t,e){if(t.length!==e.length)throw new z({expectedLength:t.length,givenLength:e.length});const n=function({params:t,values:e}){const n=[];for(let s=0;s<t.length;s++)n.push(Pt({param:t[s],value:e[s]}));return n}({params:t,values:e}),s=_t(n);return 0===s.length?"0x":s}function Pt({param:t,value:s}){const r=function(t){const e=t.match(/^(.*)\[(\d+)?\]$/);return e?[e[2]?Number(e[2]):null,e[1]]:void 0}(t.type);if(r){const[e,n]=r;return function(t,{length:e,param:n}){const s=null===e;if(!Array.isArray(t))throw new q(t);if(!s&&t.length!==e)throw new M({expectedLength:e,givenLength:t.length,type:`${n.type}[${e}]`});let r=!1;const a=[];for(let i=0;i<t.length;i++){const e=Pt({param:n,value:t[i]});e.dynamic&&(r=!0),a.push(e)}if(s||r){const t=_t(a);if(s){const e=i(a.length,{size:32});return{dynamic:!0,encoded:a.length>0?xt([e,t]):e}}if(r)return{dynamic:!0,encoded:t}}return{dynamic:!1,encoded:xt(a.map((({encoded:t})=>t)))}}(s,{length:e,param:{...t,type:n}})}if("tuple"===t.type)return function(t,{param:e}){let n=!1;const s=[];for(let i=0;i<e.components.length;i++){const r=e.components[i],a=Pt({param:r,value:t[Array.isArray(t)?i:r.name]});s.push(a),a.dynamic&&(n=!0)}return{dynamic:n,encoded:n?_t(s):xt(s.map((({encoded:t})=>t)))}}(s,{param:t});if("address"===t.type)return function(t){if(!vt(t))throw new ft({address:t});return{dynamic:!1,encoded:l(t.toLowerCase())}}(s);if("bool"===t.type)return function(t){if("boolean"!=typeof t)throw new e(`Invalid boolean value: "${t}" (type: ${typeof t}). Expected: \`true\` or \`false\`.`);return{dynamic:!1,encoded:l(d(t))}}(s);if(t.type.startsWith("uint")||t.type.startsWith("int")){const e=t.type.startsWith("int"),[,,n="256"]=At.exec(t.type)??[];return function(t,{signed:e,size:n=256}){if("number"==typeof n){const s=2n**(BigInt(n)-(e?1n:0n))-1n,i=e?-s-1n:0n;if(t>s||t<i)throw new h({max:s.toString(),min:i.toString(),signed:e,size:n/8,value:t.toString()})}return{dynamic:!1,encoded:i(t,{size:32,signed:e})}}(s,{signed:e,size:Number(n)})}if(t.type.startsWith("bytes"))return function(t,{param:e}){const[,s]=e.type.split("bytes"),r=n(t);if(!s){let e=t;return r%32!=0&&(e=l(e,{dir:"right",size:32*Math.ceil((t.length-2)/2/32)})),{dynamic:!0,encoded:xt([l(i(r,{size:32})),e])}}if(r!==Number.parseInt(s))throw new E({expectedSize:Number.parseInt(s),value:t});return{dynamic:!1,encoded:l(t,{dir:"right"})}}(s,{param:t});if("string"===t.type)return function(t){const e=p(t),s=Math.ceil(n(e)/32),r=[];for(let n=0;n<s;n++)r.push(l($t(e,32*n,32*(n+1)),{dir:"right"}));return{dynamic:!0,encoded:xt([l(i(n(e),{size:32})),...r])}}(s);throw new j(t.type,{docsPath:"/docs/contract/encodeAbiParameters"})}function _t(t){let e=0;for(let i=0;i<t.length;i++){const{dynamic:s,encoded:r}=t[i];e+=s?32:n(r)}const s=[],r=[];let a=0;for(let o=0;o<t.length;o++){const{dynamic:c,encoded:u}=t[o];c?(s.push(i(e+a,{size:32})),r.push(u),a+=n(u)):s.push(u)}return xt([...s,...r])}const Mt=t=>$t(yt(t),0,4);function Et(t,e){const n=typeof t,s=e.type;switch(s){case"address":return vt(t,{strict:!1});case"bool":return"boolean"===n;case"function":case"string":return"string"===n;default:return"tuple"===s&&"components"in e?Object.values(e.components).every(((e,n)=>Et(Object.values(t)[n],e))):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(s)?"number"===n||"bigint"===n:/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(s)?"string"===n||t instanceof Uint8Array:!!/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(s)&&(Array.isArray(t)&&t.every((t=>Et(t,{...e,type:s.replace(/(\[[0-9]{0,}\])$/,"")}))))}}function zt(t,e,n){for(const s in t){const i=t[s],r=e[s];if("tuple"===i.type&&"tuple"===r.type&&"components"in i&&"components"in r)return zt(i.components,r.components,n[s]);const a=[i.type,r.type];if(!(!a.includes("address")||!a.includes("bytes20"))||(a.includes("address")&&a.includes("string")||!(!a.includes("address")||!a.includes("bytes")))&&vt(n[s],{strict:!1}))return a}}const Ot="/docs/contract/encodeFunctionData";function Nt(t){const{abi:e,args:n,functionName:i}=t;let r=e[0];if(i){const t=function(t){const{abi:e,args:n=[],name:i}=t,r=s(i,{strict:!1}),a=e.filter((t=>r?"function"===t.type?Mt(t)===i:"event"===t.type&&mt(t)===i:"name"in t&&t.name===i));if(0===a.length)return;if(1===a.length)return a[0];let o;for(const s of a)if("inputs"in s)if(n&&0!==n.length){if(s.inputs&&0!==s.inputs.length&&s.inputs.length===n.length&&n.every(((t,e)=>{const n="inputs"in s&&s.inputs[e];return!!n&&Et(t,n)}))){if(o&&"inputs"in o&&o.inputs){const t=zt(s.inputs,o.inputs,n);if(t)throw new N({abiItem:s,type:t[0]},{abiItem:o,type:t[1]})}o=s}}else if(!s.inputs||0===s.inputs.length)return s;return o||a[0]}({abi:e,args:n,name:i});if(!t)throw new O(i,{docsPath:Ot});r=t}if("function"!==r.type)throw new O(void 0,{docsPath:Ot});return{abi:[r],functionName:Mt(P(r))}}function Ct(t){const{args:e}=t,{abi:n,functionName:s}=1===t.abi.length&&(null==(i=t.functionName)?void 0:i.startsWith("0x"))?t:Nt(t);var i;const r=n[0];return It([s,("inputs"in r&&r.inputs?St(r.inputs,e??[]):void 0)??"0x"])}class jt extends e{constructor({domain:t}){super(`Invalid domain "${y(t)}".`,{metaMessages:["Must be a valid EIP-712 domain."]})}}class qt extends e{constructor({primaryType:t,types:e}){super(`Invalid primary type \`${t}\` must be one of \`${JSON.stringify(Object.keys(e))}\`.`,{docsPath:"/api/glossary/Errors#typeddatainvalidprimarytypeerror",metaMessages:["Check that the primary type is a key in `types`."]})}}class Lt extends e{constructor({type:t}){super(`Struct type "${t}" is invalid.`,{metaMessages:["Struct type must not be a Solidity type."],name:"InvalidStructTypeError"})}}function Rt(t){const{domain:e={},message:s,primaryType:r}=t,a={EIP712Domain:Wt({domain:e}),...t.types};!function(t){const{domain:e,message:s,primaryType:r,types:a}=t,o=(t,e)=>{for(const s of t){const{name:t,type:r}=s,c=e[t],u=r.match(At);if(u&&("number"==typeof c||"bigint"==typeof c)){const[t,e,n]=u;i(c,{signed:"int"===e,size:Number.parseInt(n)/8})}if("address"===r&&"string"==typeof c&&!vt(c))throw new ft({address:c});const l=r.match(kt);if(l){const[t,e]=l;if(e&&n(c)!==Number.parseInt(e))throw new C({expectedSize:Number.parseInt(e),givenSize:n(c)})}const d=a[r];d&&(Gt(r),o(d,c))}};if(a.EIP712Domain&&e){if("object"!=typeof e)throw new jt({domain:e});o(a.EIP712Domain,e)}if("EIP712Domain"!==r){if(!a[r])throw new qt({primaryType:r,types:a});o(a[r],s)}}({domain:e,message:s,primaryType:r,types:a});const o=["0x1901"];return e&&o.push(function({domain:t,types:e}){return Ht({data:t,primaryType:"EIP712Domain",types:e})}({domain:e,types:a})),"EIP712Domain"!==r&&o.push(Ht({data:s,primaryType:r,types:a})),dt(xt(o))}function Ht({data:t,primaryType:e,types:n}){return dt(Ft({data:t,primaryType:e,types:n}))}function Ft({data:t,primaryType:e,types:n}){const s=[{type:"bytes32"}],i=[Ut({primaryType:e,types:n})];for(const r of n[e]){const[e,a]=Dt({types:n,name:r.name,type:r.type,value:t[r.name]});s.push(e),i.push(a)}return St(s,i)}function Ut({primaryType:t,types:e}){const n=o(function({primaryType:t,types:e}){let n="";const s=Vt({primaryType:t,types:e});s.delete(t);const i=[t,...Array.from(s).sort()];for(const r of i)n+=`${r}(${e[r].map((({name:t,type:e})=>`${e} ${t}`)).join(",")})`;return n}({primaryType:t,types:e}));return dt(n)}function Vt({primaryType:t,types:e},n=new Set){const s=t.match(/^\w*/u),i=null==s?void 0:s[0];if(n.has(i)||void 0===e[i])return n;n.add(i);for(const r of e[i])Vt({primaryType:r.type,types:e},n);return n}function Dt({types:t,name:e,type:n,value:s}){if(void 0!==t[n])return[{type:"bytes32"},dt(Ft({data:s,primaryType:n,types:t}))];if("bytes"===n){return[{type:"bytes32"},dt(s=`0x${(s.length%2?"0":"")+s.slice(2)}`)]}if("string"===n)return[{type:"bytes32"},dt(o(s))];if(n.lastIndexOf("]")===n.length-1){const i=n.slice(0,n.lastIndexOf("[")),r=s.map((n=>Dt({name:e,type:i,types:t,value:n})));return[{type:"bytes32"},dt(St(r.map((([t])=>t)),r.map((([,t])=>t))))]}return[{type:n},s]}function Wt({domain:t}){return["string"==typeof(null==t?void 0:t.name)&&{name:"name",type:"string"},(null==t?void 0:t.version)&&{name:"version",type:"string"},("number"==typeof(null==t?void 0:t.chainId)||"bigint"==typeof(null==t?void 0:t.chainId))&&{name:"chainId",type:"uint256"},(null==t?void 0:t.verifyingContract)&&{name:"verifyingContract",type:"address"},(null==t?void 0:t.salt)&&{name:"salt",type:"bytes32"}].filter(Boolean)}function Gt(t){if("address"===t||"bool"===t||"string"===t||t.startsWith("bytes")||t.startsWith("uint")||t.startsWith("int"))throw new Lt({type:t})}function Xt(t,e){return dt(function(t){const e="string"==typeof t?p(t):"string"==typeof t.raw?t.raw:m(t.raw);return xt([p(`Ethereum Signed Message:\n${n(e)}`),e])}(t),e)}const Jt=()=>"9.1.0",Kt=t=>t.toString(16).padStart(2,"0"),Qt=()=>"undefined"!=typeof window?(t=>{const e=new Uint8Array(t/2);return window.crypto.getRandomValues(e),Array.from(e,Kt).join("")})(10):(new Date).getTime().toString(36);class Yt{}var Zt,te,ee;Yt.makeRequest=(t,e)=>({id:Qt(),method:t,params:e,env:{sdkVersion:"9.1.0"}}),Yt.makeResponse=(t,e,n)=>({id:t,success:!0,version:n,data:e}),Yt.makeErrorResponse=(t,e,n)=>({id:t,success:!1,error:e,version:n}),(te=Zt||(Zt={})).sendTransactions="sendTransactions",te.rpcCall="rpcCall",te.getChainInfo="getChainInfo",te.getSafeInfo="getSafeInfo",te.getTxBySafeTxHash="getTxBySafeTxHash",te.getSafeBalances="getSafeBalances",te.signMessage="signMessage",te.signTypedMessage="signTypedMessage",te.getEnvironmentInfo="getEnvironmentInfo",te.getOffChainSignature="getOffChainSignature",te.requestAddressBook="requestAddressBook",te.wallet_getPermissions="wallet_getPermissions",te.wallet_requestPermissions="wallet_requestPermissions",(ee||(ee={})).requestAddressBook="requestAddressBook";class ne{constructor(t=null,e=!1){this.allowedOrigins=null,this.callbacks=new Map,this.debugMode=!1,this.isServer="undefined"==typeof window,this.isValidMessage=({origin:t,data:e,source:n})=>{const s=!e,i=!this.isServer&&n===window.parent,r=void 0!==e.version&&parseInt(e.version.split(".")[0]),a="number"==typeof r&&r>=1;let o=!0;return Array.isArray(this.allowedOrigins)&&(o=void 0!==this.allowedOrigins.find((e=>e.test(t)))),!s&&i&&a&&o},this.logIncomingMessage=t=>{},this.onParentMessage=t=>{this.isValidMessage(t)&&(this.debugMode&&this.logIncomingMessage(t),this.handleIncomingMessage(t.data))},this.handleIncomingMessage=t=>{const{id:e}=t,n=this.callbacks.get(e);n&&(n(t),this.callbacks.delete(e))},this.send=(t,e)=>{const n=Yt.makeRequest(t,e);if(this.isServer)throw new Error("Window doesn't exist");return window.parent.postMessage(n,"*"),new Promise(((t,e)=>{this.callbacks.set(n.id,(n=>{n.success?t(n):e(new Error(n.error))}))}))},this.allowedOrigins=t,this.debugMode=e,this.isServer||window.addEventListener("message",this.onParentMessage)}}const se=t=>"object"==typeof t&&null!=t&&"domain"in t&&"types"in t&&"message"in t;t();class ie{constructor(t){this.communicator=t}async getBySafeTxHash(t){if(!t)throw new Error("Invalid safeTxHash");return(await this.communicator.send(Zt.getTxBySafeTxHash,{safeTxHash:t})).data}async signMessage(t){const e={message:t};return(await this.communicator.send(Zt.signMessage,e)).data}async signTypedMessage(t){if(!se(t))throw new Error("Invalid typed data");return(await this.communicator.send(Zt.signTypedMessage,{typedData:t})).data}async send({txs:t,params:e}){if(!t||!t.length)throw new Error("No transactions were passed");const n={txs:t,params:e};return(await this.communicator.send(Zt.sendTransactions,n)).data}}const re={eth_call:"eth_call",eth_gasPrice:"eth_gasPrice",eth_getLogs:"eth_getLogs",eth_getBalance:"eth_getBalance",eth_getCode:"eth_getCode",eth_getBlockByHash:"eth_getBlockByHash",eth_getBlockByNumber:"eth_getBlockByNumber",eth_getStorageAt:"eth_getStorageAt",eth_getTransactionByHash:"eth_getTransactionByHash",eth_getTransactionReceipt:"eth_getTransactionReceipt",eth_getTransactionCount:"eth_getTransactionCount",eth_estimateGas:"eth_estimateGas",safe_setSettings:"safe_setSettings"},ae={defaultBlockParam:(t="latest")=>t,returnFullTxObjectParam:(t=!1)=>t,blockNumberToHex:t=>Number.isInteger(t)?`0x${t.toString(16)}`:t};class oe{constructor(t){this.communicator=t,this.call=this.buildRequest({call:re.eth_call,formatters:[null,ae.defaultBlockParam]}),this.getBalance=this.buildRequest({call:re.eth_getBalance,formatters:[null,ae.defaultBlockParam]}),this.getCode=this.buildRequest({call:re.eth_getCode,formatters:[null,ae.defaultBlockParam]}),this.getStorageAt=this.buildRequest({call:re.eth_getStorageAt,formatters:[null,ae.blockNumberToHex,ae.defaultBlockParam]}),this.getPastLogs=this.buildRequest({call:re.eth_getLogs}),this.getBlockByHash=this.buildRequest({call:re.eth_getBlockByHash,formatters:[null,ae.returnFullTxObjectParam]}),this.getBlockByNumber=this.buildRequest({call:re.eth_getBlockByNumber,formatters:[ae.blockNumberToHex,ae.returnFullTxObjectParam]}),this.getTransactionByHash=this.buildRequest({call:re.eth_getTransactionByHash}),this.getTransactionReceipt=this.buildRequest({call:re.eth_getTransactionReceipt}),this.getTransactionCount=this.buildRequest({call:re.eth_getTransactionCount,formatters:[null,ae.defaultBlockParam]}),this.getGasPrice=this.buildRequest({call:re.eth_gasPrice}),this.getEstimateGas=t=>this.buildRequest({call:re.eth_estimateGas})([t]),this.setSafeSettings=this.buildRequest({call:re.safe_setSettings})}buildRequest(t){const{call:e,formatters:n}=t;return async t=>{n&&Array.isArray(t)&&n.forEach(((e,n)=>{e&&(t[n]=e(t[n]))}));const s={call:e,params:t||[]};return(await this.communicator.send(Zt.rpcCall,s)).data}}}const ce=4001;class ue extends Error{constructor(t,e,n){super(t),this.code=e,this.data=n,Object.setPrototypeOf(this,ue.prototype)}}class le{constructor(t){this.communicator=t}async getPermissions(){return(await this.communicator.send(Zt.wallet_getPermissions,void 0)).data}async requestPermissions(t){if(!this.isPermissionRequestValid(t))throw new ue("Permissions request is invalid",ce);try{return(await this.communicator.send(Zt.wallet_requestPermissions,t)).data}catch{throw new ue("Permissions rejected",ce)}}isPermissionRequestValid(t){return t.every((t=>"object"==typeof t&&Object.keys(t).every((t=>!!Object.values(ee).includes(t)))))}}const de=(t,e)=>e.some((e=>e.parentCapability===t));class he{constructor(t){this.communicator=t}async getChainInfo(){return(await this.communicator.send(Zt.getChainInfo,void 0)).data}async getInfo(){return(await this.communicator.send(Zt.getSafeInfo,void 0)).data}async experimental_getBalances({currency:t="usd"}={}){return(await this.communicator.send(Zt.getSafeBalances,{currency:t})).data}async check1271Signature(t,e="0x"){const n=await this.getInfo(),s=Ct({abi:[{constant:!1,inputs:[{name:"_dataHash",type:"bytes32"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[t,e]}),i={call:re.eth_call,params:[{to:n.safeAddress,data:s},"latest"]};try{return"0x1626ba7e"===(await this.communicator.send(Zt.rpcCall,i)).data.slice(0,10).toLowerCase()}catch(r){return!1}}async check1271SignatureBytes(t,e="0x"){const n=await this.getInfo(),s=Ct({abi:[{constant:!1,inputs:[{name:"_data",type:"bytes"},{name:"_signature",type:"bytes"}],name:"isValidSignature",outputs:[{name:"",type:"bytes4"}],payable:!1,stateMutability:"nonpayable",type:"function"}],functionName:"isValidSignature",args:[t,e]}),i={call:re.eth_call,params:[{to:n.safeAddress,data:s},"latest"]};try{return"0x20c13b0b"===(await this.communicator.send(Zt.rpcCall,i)).data.slice(0,10).toLowerCase()}catch(r){return!1}}calculateMessageHash(t){return Xt(t)}calculateTypedMessageHash(t){const e="object"==typeof t.domain.chainId?t.domain.chainId.toNumber():Number(t.domain.chainId);let n=t.primaryType;if(!n){const e=Object.values(t.types),s=Object.keys(t.types).filter((t=>e.every((e=>e.every((({type:e})=>e.replace("[","").replace("]","")!==t))))));if(0===s.length||s.length>1)throw new Error("Please specify primaryType");n=s[0]}return Rt({message:t.message,domain:{...t.domain,chainId:e,verifyingContract:t.domain.verifyingContract,salt:t.domain.salt},types:t.types,primaryType:n})}async getOffChainSignature(t){return(await this.communicator.send(Zt.getOffChainSignature,t)).data}async isMessageSigned(t,e="0x"){let n;if("string"==typeof t&&(n=async()=>{const n=this.calculateMessageHash(t);return await this.isMessageHashSigned(n,e)}),se(t)&&(n=async()=>{const n=this.calculateTypedMessageHash(t);return await this.isMessageHashSigned(n,e)}),n){return await n()}throw new Error("Invalid message type")}async isMessageHashSigned(t,e="0x"){const n=[this.check1271Signature.bind(this),this.check1271SignatureBytes.bind(this)];for(const s of n){if(await s(t,e))return!0}return!1}async getEnvironmentInfo(){return(await this.communicator.send(Zt.getEnvironmentInfo,void 0)).data}async requestAddressBook(){return(await this.communicator.send(Zt.requestAddressBook,void 0)).data}}!function(t,e,n,s){var i,r=arguments.length,a=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,s);else for(var o=t.length-1;o>=0;o--)(i=t[o])&&(a=(r<3?i(a):r>3?i(e,n,a):i(e,n))||a);r>3&&a&&Object.defineProperty(e,n,a)}([(t,e,n)=>{const s=n.value;return n.value=async function(){const t=new le(this.communicator);let n=await t.getPermissions();if(de(e,n)||(n=await t.requestPermissions([{[e]:{}}])),!de(e,n))throw new ue("Permissions rejected",ce);return s.apply(this)},n}],he.prototype,"requestAddressBook",null);class pe{constructor(t={}){const{allowedDomains:e=null,debug:n=!1}=t;this.communicator=new ne(e,n),this.eth=new oe(this.communicator),this.txs=new ie(this.communicator),this.safe=new he(this.communicator),this.wallet=new le(this.communicator)}}export{Yt as MessageFormatter,Zt as Methods,re as RPC_CALLS,ee as RestrictedMethods,pe as default,Jt as getSDKVersion,se as isObjectEIP712TypedData};
