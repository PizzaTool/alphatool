import{h as e,p as a,d as t,q as s,j as o,c as r,g as n,b as l,x as i,u as d,P as u,Q as c,N as v,r as p,aS as f,o as b,aF as m,aT as w,aU as y,aV as h,aW as C,aX as _,aY as g,R as A,s as P,a as S,v as j,w as E,k as x,a2 as I,aZ as T,a_ as k,a$ as D,b0 as N,_ as U}from"./index.js";import{a as B,b as K}from"./el-table-column.js";import"./el-tooltip.js";import"./el-popper.js";import{E as O}from"./el-button.js";import{E as W}from"./el-tag.js";import{E as $}from"./el-message.js";import{_ as z}from"./aria.js";import"./_baseIteratee.js";const F=e({direction:{type:String,values:["horizontal","vertical"],default:"horizontal"},contentPosition:{type:String,values:["left","center","right"],default:"center"},borderStyle:{type:a(String),default:"solid"}}),R=t({name:"ElDivider"});const V=v(z(t({...R,props:F,setup(e){const a=e,t=s("divider"),v=o((()=>t.cssVar({"border-style":a.borderStyle})));return(e,a)=>(n(),r("div",{class:i([d(t).b(),d(t).m(e.direction)]),style:c(d(v)),role:"separator"},[e.$slots.default&&"vertical"!==e.direction?(n(),r("div",{key:0,class:i([d(t).e("text"),d(t).is(e.contentPosition)])},[u(e.$slots,"default")],2)):l("v-if",!0)],6))}}),[["__file","divider.vue"]]));const Z={class:"page"},q="0x9dC8F0511BEEacf49CC775E4962280907efffa97",G=U(t({__name:"index",setup(e){const a=function(){const e=p(f.state.activeChain),a=p(f.state.chains),t=p({allAccounts:[],address:void 0,caipAddress:void 0,status:void 0,isConnected:!1,embeddedWalletInfo:void 0});function s(e,a){var s,o;const r=w.getConnectedConnectorId(a),n=a?y.getAuthConnector(a):void 0,l=a?null==(s=e.get(a))?void 0:s.accountState:h.state;t.value.allAccounts=(null==l?void 0:l.allAccounts)||[],t.value.address=C.getPlainAddress(null==l?void 0:l.caipAddress),t.value.caipAddress=null==l?void 0:l.caipAddress,t.value.status=null==l?void 0:l.status,t.value.isConnected=Boolean(null==l?void 0:l.caipAddress);const i=a||f.state.activeChain;t.value.embeddedWalletInfo=n&&r===_.CONNECTOR_ID.AUTH?{user:null==l?void 0:l.user,authProvider:(null==l?void 0:l.socialProvider)??"email",accountType:null==(o=null==l?void 0:l.preferredAccountTypes)?void 0:o[i],isSmartAccountDeployed:Boolean(null==l?void 0:l.smartAccountDeployed)}:void 0}const o=f.subscribeKey("activeChain",(t=>{e.value=t,s(a.value,e.value)})),r=f.subscribe((t=>{a.value=t.chains,s(a.value,e.value)}));return b((()=>{s(a.value,e.value)})),m((()=>{r(),o()})),t}(),t=p([{name:"ZKJ",address:"0xc71b5f631354be6853efe9c3ab6b9590f8302e81",authCount:0},{name:"USTD",address:"0x55d398326f99059ff775485246999027b3197955",authCount:0},{name:"KOGE",address:"0xe6df05ce8c8301223373cf5b969afcb1498c5528",authCount:0}]),s=["function approve(address spender, uint256 amount) public returns (bool)","function allowance(address owner, address spender) public view returns (uint256)"],o=function(e){const a=p(g.state.providers[e]),t=p(g.state.providerIds[e]),s=g.subscribe((s=>{a.value=s.providers[e],t.value=s.providerIds[e]}));return m((()=>{null==s||s()})),A({walletProvider:a,walletProviderType:t})}("eip155");return P((()=>a.value.address),(async e=>{if(e)try{const e=t.value.map((async e=>{const t=await(async e=>{try{const t=o.walletProvider;if(!t)return 0;const r=new T(t),n=await r.getSigner(),l=new k(e,s,n),i=await l.allowance(a.value.address,q);return N(i,18)}catch(t){}})(e.address);return{...e,authCount:Number(t)}}));t.value=await Promise.all(e)}catch(r){}}),{immediate:!0}),(e,l)=>{const i=V,u=K,c=W,v=O,p=B;return n(),r("div",Z,[l[3]||(l[3]=S("div",{class:"title"},"代币授权列表",-1)),j(i),j(p,{data:d(t),style:{width:"100%"},border:""},{default:E((()=>[j(u,{prop:"name",label:"代币名称"}),j(u,{prop:"authCount",label:"authCount"},{default:E((e=>[S("div",null,[e.row.authCount<2e3?(n(),x(c,{key:0,type:"danger"},{default:E((()=>l[0]||(l[0]=[I("未授权")]))),_:1,__:[0]})):(n(),x(c,{key:1,type:"success"},{default:E((()=>l[1]||(l[1]=[I("已授权")]))),_:1,__:[1]}))])])),_:1}),j(u,{prop:"authCount",label:"授权"},{default:E((e=>[j(v,{type:"warning",plain:"",disabled:e.row.authCount>=2e3,onClick:t=>(async e=>{if(!a.value.isConnected)throw new Error("User is not connected");try{const a=new T(o.walletProvider),t=await a.getSigner(),r=new k(e,s,t),n=D("1000000000000",18),l=await r.approve(q,n);await l.wait()}catch(t){$.error("授权失败")}})(e.row.address)},{default:E((()=>l[2]||(l[2]=[I("授权合约")]))),_:2,__:[2]},1032,["disabled","onClick"])])),_:1})])),_:1},8,["data"])])}}}),[["__scopeId","data-v-3bc99e43"]]);export{G as default};
